let config={locateFile:()=>"/garmin/sql-wasm.wasm"};var db=null,invertSpecificationRequirements=!1,numberOfProducts=0;function startGarminWizard(){document.getElementById("loadingIndicator").style.display="block",tabSupport(),initSqlJs(config).then((function(e){console.log("sql.js initialized \ud83c\udf89"),fetch("/garmin/products.db?v=6").then((e=>e.arrayBuffer())).then((t=>{db=new e.Database(new Uint8Array(t)),addGarminWizard(),document.getElementById("loadingIndicator").style.display="none",document.getElementById("garminwizard").style.display="block"})).catch((e=>{console.error("Error loading database:",e),document.getElementById("loadingIndicator").style.display="none",document.getElementById("garminwizard").style.display="block"}))}))}function addGarminWizard(){populateDateOfDownloading(),populateNumberOfUniqueProducts(),populateNumberOfUniqeSpecifications();var e=db.exec("SELECT specGroupKeyDisplayName, specKey, specValue, specDisplayName, specDisplayValue FROM products GROUP BY specGroupKeyDisplayName, specKey, specValue ORDER BY specGroupKeyDisplayName, specKey");groupedSpecs=groupProductSpecsBySpecGroupKeyDisplayName(e),CreateControlButtons(),iterateOverTheGroupedSpecsAndCreateHTMLElements(groupedSpecs),PopulateMatchingProductResults()}function iterateOverTheGroupedSpecsAndCreateHTMLElements(e){var t=document.getElementById("garmin");let n=null,a=0,c=0;Object.entries(e).forEach((([e,o])=>{var i=document.createElement("h3");i.textContent=e,i.classList.add("garmintitle");var r=document.createElement("span");r.style.display="none",r.classList.add("garminbadge"),r.textContent="0",r.setAttribute("data-group",e),i.appendChild(r),i.addEventListener("click",(function(){const e=this.nextElementSibling;e.classList.toggle("garminexpanded"),e.classList.toggle("garmincollapsed"),this.classList.toggle("garmin-expanded-arrow")})),t.appendChild(i);var d=document.createElement("div");d.classList.add("garmincollapsed"),d.classList.add("content"),t.appendChild(d);var l=document.createElement("table"),s=document.createElement("tbody");o.forEach((t=>{c++;var o=document.createElement("tr"),i=document.createElement("td"),r=document.createElement("td"),d=document.createElement("td"),l=document.createElement("div");l.innerHTML=t.specdisplayvalue,d.appendChild(l);var u=document.createElement("div");u.innerHTML="<span>Products with specification</span>",u.classList.add("garmintitle-without-content");var p=document.createElement("div");p.setAttribute("id","row"+c+"resultCell"),p.classList.add("garmincollapsed");var m=document.createElement("div");m.innerHTML="<span>Products without specification</span>",m.classList.add("garmintitle-without-content");var g=document.createElement("div");g.setAttribute("id","row"+c+"invertedResultCell"),g.classList.add("garmincollapsed"),d.appendChild(u),d.appendChild(p),d.appendChild(m),d.appendChild(g),u.addEventListener("click",(function(){const e=this.nextElementSibling;e.classList.toggle("garminexpanded"),e.classList.toggle("garmincollapsed"),this.classList.toggle("garmin-expanded-arrow"),e.classList.contains("garminhasbeenexpanded")||(e.classList.add("garminhasbeenexpanded"),PopulateCellWithProducts(p,t.speckey,t.specvalue))})),m.addEventListener("click",(function(){const e=this.nextElementSibling;e.classList.toggle("garminexpanded"),e.classList.toggle("garmincollapsed"),this.classList.toggle("garmin-expanded-arrow"),e.classList.contains("garminhasbeenexpanded")||(e.classList.add("garminhasbeenexpanded"),PopulateCellWithInvertedProducts(g,t.speckey,t.specvalue))}));var h=CreateCheckbox(t.speckey,t.specvalue,e);h.addEventListener("change",(function(){updateBadgeCount(e),h.checked?(u.classList.remove("garmintitle-without-content"),u.classList.add("garmintitle-with-content"),m.classList.remove("garmintitle-without-content"),m.classList.add("garmintitle-with-content")):(u.classList.remove("garmintitle-with-content"),u.classList.add("garmintitle-without-content"),m.classList.remove("garmintitle-with-content"),m.classList.add("garmintitle-without-content"),p.classList.remove("garminexpanded"),p.classList.add("garmincollapsed"),g.classList.remove("garminexpanded"),g.classList.add("garmincollapsed")),PopulateMatchingProductResults()})),i.appendChild(h),r.innerHTML=t.specdisplayname,o.appendChild(i),o.appendChild(r),o.appendChild(d),n!==t.speckey&&(a=1-a),o.style.backgroundColor=0===a?"#aaf0aa":"#00e000",n=t.speckey,s.appendChild(o)})),l.appendChild(s),d.appendChild(l),d.appendChild(document.createElement("br"))}))}function groupProductSpecsBySpecGroupKeyDisplayName(e){var t={};return e[0].values.forEach((e=>{var n={SpecGroupKeyDisplayName:e[0],speckey:e[1],specvalue:e[2],specdisplayname:e[3],specdisplayvalue:e[4]};t[n.SpecGroupKeyDisplayName]||(t[n.SpecGroupKeyDisplayName]=[]),t[n.SpecGroupKeyDisplayName].push(n)})),t}function createProductResultCheckbox(e){var t=document.createElement("input");return t.classList.add("garmin-checkbox"),t.classList.add("garmin-product-result-checkbox"),t.type="checkbox",t.value=e,t}function CreateCheckbox(e,t,n){var a=document.createElement("input");return a.classList.add("garmin-checkbox"),a.classList.add("garmin-specification-checkbox"),a.type="checkbox",a.value=e,a.setAttribute("data-group",n),a.setAttribute("data-value",t),a}function CreateControlButtons(){var e=document.getElementById("expand-all-button"),t=document.getElementById("collapse-all-button"),n=document.getElementById("check-all-button"),a=document.getElementById("uncheck-all-button");e.addEventListener("click",expandAll),t.addEventListener("click",collapseAll),n.addEventListener("click",CheckAll),a.addEventListener("click",UnCheckAll)}function createCheckboxToInvertSpecificationRequirements(){var e=document.createElement("input");e.classList.add("garmin-checkbox"),e.type="checkbox",e.addEventListener("click",(function(){invertSpecificationRequirements=!!e.checked,updateAllResults()})),document.getElementById("invert-checkbox").appendChild(e)}function expandAll(){document.querySelectorAll(".content").forEach((e=>{e.classList.remove("garmincollapsed"),e.classList.add("garminexpanded")}))}function collapseAll(){document.querySelectorAll(".content").forEach((e=>{e.classList.remove("garminexpanded"),e.classList.add("garmincollapsed")}))}function CheckAll(){var e=getAllSpecificationCheckBoxes(),t="",n="",a=!0,c=0;e.forEach((e=>{e.checked=!0,c++,n=e.getAttribute("data-group"),1==a&&(a=!1,t=n),n!=t&&(UpdateBadgeCountWithNumber(t,c),t=n,c=0)})),UpdateBadgeCountWithNumber(n,c),PopulateMatchingProductResults()}function UnCheckAll(){var e=getAllSpecificationCheckBoxes(),t="";e.forEach((e=>{e.checked=!1;var n=e.getAttribute("data-group");n!=t&&(UpdateBadgeCountWithNumber(n,0),t=n)})),PopulateMatchingProductResults()}function UpdateBadgeCountWithNumber(e,t){const n=document.querySelector(`.garminbadge[data-group="${e}"]`);t>0?(n.textContent=t,n.style.display="inline-block"):n.style.display="none"}function updateBadgeCount(e){const t=document.querySelectorAll(`input[type="checkbox"][data-group="${e}"]`);let n=0;t.forEach((e=>{e.checked&&n++})),UpdateBadgeCountWithNumber(e,n)}function populateDateOfDownloading(){var e=db.exec("SELECT last_updated FROM last_update;")[0].values[0],t=new Date(e),n=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0}).format(t);console.log(`Last updated: ${n}`),document.getElementById("productDownloadDatePlaceholder").innerHTML+=n}function populateNumberOfUniqueProducts(){var e=db.exec("SELECT COUNT(DISTINCT productId) AS NumberOfProducts FROM products;")[0].values[0];console.log(`Number of products:${e}`),document.getElementById("productCountPlaceholder").innerHTML+=e}function populateNumberOfUniqeSpecifications(){var e=db.exec("SELECT COUNT(DISTINCT specKey) AS NumberOfSpecifications FROM products;")[0].values[0];console.log(`Number of products:${e}`),document.getElementById("specificationCountPlaceholder").innerHTML+=e}function PopulateCellWithProducts(e,t,n){var a=`SELECT productId, displayName, productUrl, price FROM products where specKey="${t}" and specValue="${n}" order by price asc`;console.log(a),db.exec(a)[0].values.forEach((t=>{var n=getFormattedPrice(t[3]);e.innerHTML+=`<a target="_blank" href="${t[2]}">${t[1]}</a> ${n}<br/>`}))}function getFormattedPrice(e){var t=e;return t=null==t?"-":"$"+t+" USD"}function PopulateCellWithInvertedProducts(e,t,n){var a=getBeginInversion();a+=`SELECT productId, displayName, productUrl FROM products where specKey="${t}" and specValue="${n}" order by price asc`,a+=getEndInversion(),console.log(a),db.exec(a)[0].values.forEach((t=>{var n=getFormattedPrice(t[3]);e.innerHTML+=`<a target="_blank" href="${t[2]}">${t[1]}</a> ${n}<br/>`}))}function updateMatchingProductsBadge(e){var t=document.getElementById("matchingProducts");t.classList.remove("garminbadgehidden"),t.classList.add("garminbadge"),t.textContent=e}function updateNumberOfUniqueSpecsBadge(e){var t=document.getElementById("numberOfUniqueSpecs");t.classList.remove("garminbadgehidden"),t.classList.add("garminbadge"),t.textContent=e}function PopulateMatchingProductResults(){var e=document.getElementById("garmin-result");e.innerHTML="";const t={};var n=getAllCheckedSpecificationCheckBoxes(),a="";if(0==n.length)a="SELECT productId, displayName, productUrl, price\n        FROM products\n        GROUP BY productId\n        ORDER BY price",updateNumberOfUniqueSpecsBadge(0);else{n.forEach((e=>{const n=e.getAttribute("data-group");t[n]||(t[n]={});const a=e.value;t[n][a]||(t[n][a]=[]),t[n][a].push(e.getAttribute("data-value"))}));var c=generateTheQueryAcrossAllSpecificationGroups(t);a=c.sqlQuery,updateNumberOfUniqueSpecsBadge(c.numberOfUniqueSpecs)}console.log(a);var o=db.exec(a);if(e.innerHTML="",0==o.length)e.innerHTML="Could not find any matching products",updateMatchingProductsBadge(0);else{var i=document.createElement("div");o[0].values.forEach((e=>{var t=getFormattedPrice(e[3]),n=createProductResultCheckbox(e[0]);n.addEventListener("change",updateCompareButtonState),i.appendChild(n);var a=document.createElement("span");i.appendChild(a),a.innerHTML+=`<a target="_blank" href="${e[2]}">${e[1]}</a> ${t}<br/>`})),e.appendChild(i);var r=createCompareButton();e.appendChild(r);var d=document.createElement("span");d.setAttribute("id","comparisonLink"),e.appendChild(d),updateMatchingProductsBadge(o[0].values.length)}}function getAllCheckedSpecificationCheckBoxes(){return document.querySelectorAll('input[type="checkbox"].garmin-specification-checkbox:checked')}function getAllUnCheckedSpecificationCheckBoxes(){return document.querySelectorAll('input[type="checkbox"].garmin-specification-checkbox:not(:checked)')}function getAllSpecificationCheckBoxes(){return document.querySelectorAll('input[type="checkbox"].garmin-specification-checkbox')}function generateTheQueryAcrossAllSpecificationGroups(e){let t="";invertSpecificationRequirements&&(t=getBeginInversion());let n=0;var a="";return Object.values(e).forEach(((e,t)=>{t>0&&(a+=" OR "),a+="(",Object.entries(e).forEach((([e,t],c)=>{n++,c>0&&(a+=" OR "),t.forEach(((t,n)=>{n>0&&(a+=" OR "),a+=`(specKey = '${e}' AND specValue = '${t}')`}))})),a+=")"})),t+=`\n    SELECT productId, displayName, productUrl, price\n    FROM products\n    WHERE ${a}\n    GROUP BY displayName\n    HAVING COUNT(specKey) = ${n}\n    ORDER BY price\n    `,invertSpecificationRequirements&&(t+=getEndInversion()),{sqlQuery:t,numberOfUniqueSpecs:n}}function getBeginInversion(){return"SELECT p.productId, p.displayName, p.productUrl, p.price\n    FROM products p\n    LEFT JOIN ("}function getEndInversion(){return") hasSpecifications ON p.productId = hasSpecifications.productId\n    WHERE hasSpecifications.productId is null\n    GROUP BY p.displayName ORDER by p.price;"}function ClearCell(e){e.innerHTML=""}function tabSupport(){var e=document.querySelectorAll(".tablinks"),t=document.querySelectorAll(".tabcontent");e.forEach((function(n){n.addEventListener("click",(function(){var n=this.getAttribute("data-page");t.forEach((function(e){e.style.display="none"})),e.forEach((function(e){e.classList.remove("active")})),document.getElementById(n).style.display="block",this.classList.add("active")}))})),document.getElementById("defaultOpen").click()}function createCompareButton(){const e=document.createElement("button");return e.textContent="Select up to 5 products to compare",e.id="compareButton",e.disabled=!0,e.classList.add("big-button"),e.addEventListener("click",compareProducts),document.body.appendChild(e),e}function getAllProductResultCheckBoxes(){return document.querySelectorAll('input[type="checkbox"].garmin-product-result-checkbox:checked')}function updateCompareButtonState(){const e=document.getElementById("compareButton"),t=getAllProductResultCheckBoxes();document.getElementById("comparisonLink").innerHTML="",t.length>5?(e.disabled=!0,e.textContent="Maximum of 5 checkboxes can be selected for comparison."):(e.disabled=!1,e.textContent="Compare products")}function compareProducts(){var e=getAllProductResultCheckBoxes(),t="https://www.garmin.com/en-US/compare/?compareProduct=";e.forEach((function(n,a){t+=n.value,a<e.length-1&&(t+="&compareProduct=")}));document.getElementById("compareButton").disabled=!0;var n=document.getElementById("comparisonLink");const a=document.createElement("a");a.href=t,a.target="_blank",a.textContent="See the comparison on Garmin's page",n.appendChild(a),console.log("Compare url: "+t)}